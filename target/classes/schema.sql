-- ============================================================
-- Script de criação da tabela de cupons
-- Banco: H2 (compatível com PostgreSQL com ajustes mínimos)
-- ============================================================

CREATE TABLE IF NOT EXISTS coupons (

    -- Chave primária auto-incrementada
    id              BIGINT          GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,

    -- Código único do cupom: sempre 6 caracteres alfanuméricos
    code            VARCHAR(6)      NOT NULL,

    -- Descrição legível do cupom
    description     VARCHAR(255)    NOT NULL,

    -- Valor do desconto (mínimo 0.5, sem máximo)
    -- NUMERIC(10,2) evita erros de ponto flutuante
    discount_value  NUMERIC(10, 2)  NOT NULL,

    -- Data de expiração (somente data, sem horário)
    expiration_date DATE            NOT NULL,

    -- Cupom publicado/visível para uso: true ou false
    published       BOOLEAN         NOT NULL DEFAULT FALSE,

    -- Timestamp de criação (preenchido automaticamente pela aplicação)
    created_at      TIMESTAMP       NOT NULL,

    -- Soft delete: NULL = ativo, NOT NULL = removido logicamente
    deleted_at      TIMESTAMP       NULL,

    -- Garante que não existam dois cupons com o mesmo código
    CONSTRAINT uq_coupons_code UNIQUE (code)
);

-- ============================================================
-- Script equivalente para PostgreSQL (comentado)
-- ============================================================
-- CREATE TABLE IF NOT EXISTS coupons (
--     id              BIGSERIAL       PRIMARY KEY,
--     code            VARCHAR(6)      NOT NULL,
--     description     VARCHAR(255)    NOT NULL,
--     discount_value  NUMERIC(10, 2)  NOT NULL,
--     expiration_date DATE            NOT NULL,
--     published       BOOLEAN         NOT NULL DEFAULT FALSE,
--     created_at      TIMESTAMP       NOT NULL,
--     deleted_at      TIMESTAMP       NULL,
--     CONSTRAINT uq_coupons_code UNIQUE (code)
-- );
